<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>金铲铲之战羁绊随机分配器</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
        --primary-color: #ff6b6b;
        --secondary-color: #4ecdc4;
        --dark-color: #292f36;
        --light-color: #f7fff7;
        --accent-color: #ffe66d;
        --success-color: #06d6a0;
        --warning-color: #ffd166;
        --info-color: #118ab2;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        background: linear-gradient(135deg, var(--dark-color) 0%, #1a1e24 100%);
        color: var(--light-color);
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
    }

    .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .header h1 {
        color: var(--accent-color);
        font-size: 28px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .header h1 i {
        color: var(--primary-color);
    }

    .header p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 16px;
    }

    /* 设置区域 */
    .setup-area {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setup-area h3 {
        color: var(--secondary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 20px;
    }

    .player-input-section {
        margin-bottom: 25px;
    }

    .input-group {
        margin-bottom: 15px;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--accent-color);
        font-weight: bold;
    }

    .player-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .player-input {
        position: relative;
    }

    .player-input input {
        width: 100%;
        padding: 12px 40px 12px 15px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.3);
        color: var(--light-color);
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .player-input input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
    }

    .player-input input::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .remove-player {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--primary-color);
        color: white;
        border: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        opacity: 0.8;
        transition: opacity 0.3s;
    }

    .remove-player:hover {
        opacity: 1;
    }

    .player-count-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .count-display {
        color: var(--accent-color);
        font-weight: bold;
        font-size: 16px;
    }

    .count-buttons {
        display: flex;
        gap: 10px;
    }

    .count-btn {
        background: var(--info-color);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .count-btn:hover {
        background: #0a7fa3;
        transform: translateY(-2px);
    }

    .count-btn:disabled {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.3);
        cursor: not-allowed;
        transform: none;
    }

    /* 规则区域 */
    .rules {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
        border-left: 4px solid var(--secondary-color);
    }

    .rules h3 {
        color: var(--secondary-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .rules ul {
        padding-left: 20px;
    }

    .rules li {
        margin-bottom: 10px;
        color: rgba(255, 255, 255, 0.85);
    }

    .rules .highlight {
        color: var(--primary-color);
        font-weight: bold;
    }

    /* 玩家结果区域 */
    .players-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .player-card {
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(255, 107, 107, 0.1) 100%);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .player-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .player-name {
        font-size: 18px;
        font-weight: bold;
        color: var(--accent-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .trait-container {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
    }

    .trait-name {
        font-size: 22px;
        font-weight: bold;
        color: var(--primary-color);
        margin-bottom: 5px;
    }

    .trait-extra {
        font-size: 14px;
        color: var(--secondary-color);
        margin-top: 8px;
    }

    .hextech-container {
        background: rgba(255, 230, 109, 0.1);
        border-radius: 10px;
        padding: 15px;
        border: 1px solid rgba(255, 230, 109, 0.3);
    }

    .hextech-name {
        font-size: 18px;
        font-weight: bold;
        color: var(--warning-color);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .hextech-desc {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.5;
    }

    /* 控制按钮 */
    .controls {
        text-align: center;
        margin: 30px 0;
    }

    .btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, #ff8e8e 100%);
        color: white;
        border: none;
        padding: 18px 45px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin: 0 10px;
    }

    .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
    }

    .btn:active {
        transform: translateY(0);
    }

    .btn-secondary {
        background: linear-gradient(135deg, var(--info-color) 0%, #0a7fa3 100%);
        box-shadow: 0 8px 20px rgba(17, 138, 178, 0.3);
    }

    .btn-secondary:hover {
        box-shadow: 0 12px 25px rgba(17, 138, 178, 0.4);
    }

    /* 统计区域 */
    .stats {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-top: 25px;
        text-align: center;
    }

    .stats h3 {
        color: var(--secondary-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .stat-item {
        background: rgba(255, 255, 255, 0.08);
        padding: 15px;
        border-radius: 10px;
    }

    .stat-label {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 22px;
        font-weight: bold;
        color: var(--accent-color);
    }

    /* 特殊规则提示 */
    .pinduoduo-rule {
        background: rgba(255, 107, 107, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        border-left: 4px solid var(--primary-color);
    }

    .pinduoduo-rule h4 {
        color: var(--primary-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .hextech-rule {
        background: rgba(255, 230, 109, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        border-left: 4px solid var(--warning-color);
    }

    .hextech-rule h4 {
        color: var(--warning-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* 底部 */
    .footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
    }

    /* 动画效果 */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-out;
    }

    .pulse {
        animation: pulse 0.5s ease;
    }

    /* 加载动画 */
    .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.1);
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* 警告提示 */
    .warning {
        background: rgba(255, 107, 107, 0.2);
        border: 1px solid rgba(255, 107, 107, 0.5);
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
        display: none;
    }

    .warning i {
        color: var(--primary-color);
        margin-right: 10px;
    }

    /* 手机适配 */
    @media (max-width: 768px) {
        .container {
            padding: 20px 15px;
        }

        .header h1 {
            font-size: 22px;
        }

        .player-inputs {
            grid-template-columns: 1fr;
        }

        .players-container {
            grid-template-columns: 1fr;
        }

        .btn {
            width: 100%;
            margin: 10px 0;
        }

        .count-buttons {
            flex-direction: column;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    /* 玩家名预设按钮 */
    .preset-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }

    .preset-btn {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 8px 15px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .preset-btn:hover {
        background: rgba(78, 205, 196, 0.2);
        color: var(--secondary-color);
        border-color: var(--secondary-color);
    }

    .preset-btn.active {
        background: var(--secondary-color);
        color: var(--dark-color);
        border-color: var(--secondary-color);
        font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container fade-in">
  <div class="header">
    <h1><i class="fas fa-crown"></i> 金铲铲之战：英雄联盟传奇 羁绊随机分配器</h1>
    <p>自定义玩家名单，随机分配羁绊与海克斯挑战</p>
  </div>

  <!-- 设置区域 -->
  <div class="setup-area">
    <h3><i class="fas fa-users"></i> 设置玩家名单</h3>

    <div class="player-input-section">
      <div class="input-group">
        <label><i class="fas fa-user-friends"></i> 请输入玩家姓名（2-8人）</label>
        <div class="player-inputs" id="playerInputs">
          <!-- 玩家输入框将在这里动态生成 -->
        </div>
      </div>

      <!-- 玩家名预设 -->
      <div class="input-group">
        <label><i class="fas fa-history"></i> 快速选择预设名单</label>
        <div class="preset-buttons">
          <button class="preset-btn" onclick="loadPreset('original')">原四人组</button>
          <button class="preset-btn" onclick="loadPreset('twoPlayers')">两人对战</button>
          <button class="preset-btn" onclick="loadPreset('sixPlayers')">六人混战</button>
          <button class="preset-btn" onclick="loadPreset('eightPlayers')">八人满员</button>
          <button class="preset-btn" onclick="clearAllPlayers()">清空名单</button>
        </div>
      </div>

      <div class="player-count-controls">
        <div class="count-display">当前玩家数：<span id="playerCount">4</span> 人</div>
        <div class="count-buttons">
          <button class="count-btn" onclick="addPlayer()" id="addPlayerBtn" title="添加玩家">
            <i class="fas fa-plus"></i>
          </button>
          <button class="count-btn" onclick="removePlayer()" id="removePlayerBtn" title="移除玩家" disabled>
            <i class="fas fa-minus"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 警告提示 -->
    <div class="warning" id="warning">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="warningText">警告信息</span>
    </div>
  </div>

  <!-- 规则区域 -->
  <div class="rules">
    <h3><i class="fas fa-book"></i> 游戏规则说明</h3>
    <ul>
      <li><span class="highlight">硬玩规则</span>：玩家必须使用分配到的羁绊阵容进行游戏</li>
      <li><span class="highlight">拼多多概率</span>：'拼多多'羁绊有20%的概率出现</li>
      <li><span class="highlight">拼多多特殊规则</span>：抽中'拼多多'的玩家阵容必须拥有随机分配的两个城邦羁绊和不少于7个非唯一羁绊
      </li>
      <li><span class="highlight">海克斯挑战</span>：每名玩家抽取一个随机海克斯挑战，如果无法完成需在群里发10元红包
      </li>
    </ul>
  </div>

  <!-- 特殊规则提示 -->
  <div class="pinduoduo-rule">
    <h4><i class="fas fa-exclamation-triangle"></i> 拼多多羁绊特殊要求</h4>
    <p>抽中"拼多多"的玩家阵容必须包含随机分配的两个城邦羁绊，并且拥有至少7个非唯一羁绊</p>
  </div>

  <div class="hextech-rule">
    <h4><i class="fas fa-tasks"></i> 海克斯挑战规则</h4>
    <p>每位玩家会随机获得一个海克斯挑战，必须在游戏结束前完成。如果无法完成挑战，需在群里发10元3人红包（自己不能抢）</p>
  </div>

  <!-- 玩家结果显示区域 -->
  <div class="players-container" id="playersContainer">
    <!-- 玩家卡片将通过JS动态生成 -->
  </div>

  <!-- 加载动画 -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>正在随机分配中...</p>
  </div>

  <!-- 控制按钮 -->
  <div class="controls">
    <button class="btn" onclick="randomizeAll()" id="randomizeBtn">
      <i class="fas fa-dice"></i> 开始随机分配
    </button>
    <button class="btn btn-secondary" onclick="resetAll()" id="resetBtn">
      <i class="fas fa-redo"></i> 重置全部
    </button>
  </div>

  <!-- 统计区域 -->
  <div class="stats">
    <h3><i class="fas fa-chart-bar"></i> 本次分配统计</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-label">玩家总数</div>
        <div class="stat-value" id="totalPlayers">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">拼多多数量</div>
        <div class="stat-value" id="pinduoduoCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">分配时间</div>
        <div class="stat-value" id="assignTime">-</div>
      </div>
    </div>
  </div>

  <div class="footer">
    <p><i class="fas fa-mobile-alt"></i> 扫码即可使用，无需下载安装</p>
    <p>© 2026 金铲铲羁绊随机分配器 | 版本 2.0 | 支持自定义玩家名单</p>
    <p style="font-size: 12px; margin-top: 10px; color: rgba(255,255,255,0.4);">
      提示：点击浏览器菜单，选择"添加到主屏幕"可像App一样使用
    </p>
  </div>
</div>

<script>
  // 默认玩家名单
  const DEFAULT_PLAYERS = ["周航宇", "周畅", "李云轩", "付叶叶"];

  // 预设名单
  const PLAYER_PRESETS = {
      'original': ["周航宇", "周畅", "李云轩", "付叶叶"],
      'twoPlayers': ["玩家1", "玩家2"],
      'sixPlayers': ["玩家1", "玩家2", "玩家3", "玩家4", "玩家5", "玩家6"],
      'eightPlayers': ["玩家1", "玩家2", "玩家3", "玩家4", "玩家5", "玩家6", "玩家7", "玩家8"]
  };

  // 所有羁绊列表（权重不同）
  const WEIGHTED_TRAITS = [
      { name: "以绪塔尔", weight: 1 },
      { name: "皮尔特沃夫", weight: 1 },
      { name: "比尔吉沃特", weight: 1 },
      { name: "德玛西亚", weight: 1 },
      { name: "暗影岛", weight: 1 },
      { name: "艾欧尼亚", weight: 1 },
      { name: "约德尔人", weight: 1 },
      { name: "拼多多", weight: 3 }, // 权重为3，实现约20%概率
      { name: "巨神峰", weight: 1 },
      { name: "祖安", weight: 1 },
      { name: "弗雷尔卓德", weight: 1 },
      { name: "诺克萨斯", weight: 1 },
      { name: "虚空", weight: 1 }
  ];

  // 城邦羁绊列表（拼多多随机分配两个）
  const ALL_AREAS = [
      "以绪塔尔", "皮尔特沃夫", "比尔吉沃特", "德玛西亚", "暗影岛",
      "艾欧尼亚", "约德尔人", "恕瑞玛", "巨神峰", "祖安",
      "弗雷尔卓德", "诺克萨斯", "虚空"
  ];

  // 海克斯挑战列表
  const HEXTEC_MAP = {
      "只用左手": "海克斯阶段不刷新选择左边。如果所选海克斯为经济类,卖掉总价值10块的奕子(2-1阶段5块 3-2阶段8块); 如果所选海克斯为战力类,刷新10次牌库(2-1阶段5次 3-2阶段8次)",
      "只用右手": "海克斯阶段不刷新选择右边。如果所选海克斯为经济类,卖掉总价值10块的奕子(2-1阶段5块 3-2阶段8块); 如果所选海克斯为战力类,刷新10次牌库(2-1阶段5次 3-2阶段8次)",
      "五字不行": "阵容不能出现五费卡",
      "解锁大师": "一局游戏解锁12张牌",
      "金光闪闪": "你的三星奕子总价值大于27",
      "6级D干的传说": "请在6级时不能买牌刷新15次牌库",
      "发十块钱": "往群里发10块钱3人红包，自己不能抢",
      "一进制空投": "你的奕子最多只能携带一件半装备",
      "我是FAKER": "在备战席同时放置一张瑞兹、一张塞拉斯、一张加里奥、一张沙皇后，语音或者游戏里打字：哈哈哈我是六冠王FAKER",
      "铜光闪闪": "你的奕子星级总数不能超过12",
      "永远的神": "阵容中必须有一张携带了满装备的三星VN",
      "龙的力量": "阵容上阵希瓦娜、铸星龙王、纳什男爵、海克斯霸王龙中的其中两张",
      "卓尔不群": "你不用遵守抽取的羁绊，阵容中享受羁绊加成的奕子不超过3张，如果有纹章类海克斯必须选择且纹章必须上场",
      "亮出你的剑": "将你价值最高的术士或者射手奕子放置在第一排",
      "藏起你的盾": "将你携带装备最多的坦克奕子放置在最后一排"
  };

  // 当前玩家名单
  let currentPlayers = [...DEFAULT_PLAYERS];
  // 分配结果
  let currentAssignments = [];

  // 初始化玩家输入框
  function initializePlayerInputs() {
      const inputsContainer = document.getElementById('playerInputs');
      inputsContainer.innerHTML = '';

      currentPlayers.forEach((playerName, index) => {
          const inputDiv = document.createElement('div');
          inputDiv.className = 'player-input';
          inputDiv.innerHTML = `
              <input type="text"
                     value="${playerName}"
                     placeholder="请输入玩家${index + 1}姓名"
                     oninput="updatePlayerName(${index}, this.value)"
                     maxlength="10">
              ${currentPlayers.length > 2 ? `<button class="remove-player" onclick="removePlayerInput(${index})" title="移除该玩家">×</button>` : ''}
          `;
          inputsContainer.appendChild(inputDiv);
      });

      // 更新玩家计数
      updatePlayerCount();
      // 更新预设按钮状态
      updatePresetButtons();
  }

  // 更新玩家姓名
  function updatePlayerName(index, value) {
      if (value.trim() === '') {
          showWarning(`玩家${index + 1}姓名不能为空，已恢复原值`);
          // 恢复原值
          const inputs = document.querySelectorAll('.player-input input');
          inputs[index].value = currentPlayers[index];
          return;
      }

      currentPlayers[index] = value.trim();
      hideWarning();
  }

  // 添加玩家
  function addPlayer() {
      if (currentPlayers.length >= 8) {
          showWarning('最多只能添加8名玩家');
          return;
      }

      const newPlayerName = `玩家${currentPlayers.length + 1}`;
      currentPlayers.push(newPlayerName);
      initializePlayerInputs();
      hideWarning();
  }

  // 移除玩家
  function removePlayer() {
      if (currentPlayers.length <= 2) {
          showWarning('至少需要2名玩家');
          return;
      }

      currentPlayers.pop();
      initializePlayerInputs();
      hideWarning();
  }

  // 移除指定玩家输入框
  function removePlayerInput(index) {
      if (currentPlayers.length <= 2) {
          showWarning('至少需要2名玩家');
          return;
      }

      currentPlayers.splice(index, 1);
      initializePlayerInputs();
      hideWarning();
  }

  // 清空所有玩家
  function clearAllPlayers() {
      currentPlayers = [];
      initializePlayerInputs();
      showWarning('已清空玩家名单，请至少添加2名玩家');
  }

  // 加载预设名单
  function loadPreset(presetName) {
      if (PLAYER_PRESETS[presetName]) {
          currentPlayers = [...PLAYER_PRESETS[presetName]];
          initializePlayerInputs();
          hideWarning();

          // 更新预设按钮状态
          updatePresetButtons();

          // 如果是原四人组，自动开始分配
          if (presetName === 'original') {
              setTimeout(() => {
                  if (confirm('已加载原四人组名单，是否开始随机分配？')) {
                      randomizeAll();
                  }
              }, 300);
          }
      }
  }

  // 更新预设按钮状态
  function updatePresetButtons() {
      const presetButtons = document.querySelectorAll('.preset-btn');
      presetButtons.forEach(btn => {
          btn.classList.remove('active');
      });

      // 检查当前名单是否匹配任何预设
      const currentPlayersStr = JSON.stringify(currentPlayers);
      Object.keys(PLAYER_PRESETS).forEach(presetName => {
          if (JSON.stringify(PLAYER_PRESETS[presetName]) === currentPlayersStr) {
              const presetBtn = document.querySelector(`.preset-btn[onclick="loadPreset('${presetName}')"]`);
              if (presetBtn) {
                  presetBtn.classList.add('active');
              }
          }
      });
  }

  // 更新玩家计数
  function updatePlayerCount() {
      document.getElementById('playerCount').textContent = currentPlayers.length;
      document.getElementById('totalPlayers').textContent = currentPlayers.length;

      // 更新按钮状态
      const addBtn = document.getElementById('addPlayerBtn');
      const removeBtn = document.getElementById('removePlayerBtn');

      addBtn.disabled = currentPlayers.length >= 8;
      removeBtn.disabled = currentPlayers.length <= 2;
  }

  // 显示警告
  function showWarning(message) {
      const warning = document.getElementById('warning');
      const warningText = document.getElementById('warningText');
      warningText.textContent = message;
      warning.style.display = 'block';

      // 3秒后自动隐藏
      setTimeout(hideWarning, 3000);
  }

  // 隐藏警告
  function hideWarning() {
      const warning = document.getElementById('warning');
      warning.style.display = 'none';
  }

  // 初始化玩家结果显示区域
  function initializePlayersDisplay() {
      const container = document.getElementById('playersContainer');
      container.innerHTML = '';

      currentPlayers.forEach((playerName, index) => {
          const playerCard = `
              <div class="player-card" id="playerCard${index}">
                  <div class="player-name">
                      <i class="fas fa-user"></i> ${playerName}
                  </div>
                  <div class="trait-container">
                      <div class="trait-name" id="trait${index}">等待分配</div>
                      <div class="trait-extra" id="extra${index}"></div>
                  </div>
                  <div class="hextech-container">
                      <div class="hextech-name" id="hexName${index}">
                          <i class="fas fa-magic"></i> 等待分配
                      </div>
                      <div class="hextech-desc" id="hexDesc${index}">点击"开始随机分配"按钮</div>
                  </div>
              </div>
          `;
          container.innerHTML += playerCard;
      });
  }

  // 权重随机算法
  function weightedRandomSelection(availableItems, weights) {
      let totalWeight = 0;
      for (let weight of weights) {
          totalWeight += weight;
      }

      let randomValue = Math.random() * totalWeight;
      let cumulativeWeight = 0;

      for (let i = 0; i < availableItems.length; i++) {
          cumulativeWeight += weights[i];
          if (randomValue < cumulativeWeight) {
              return {
                  item: availableItems[i],
                  index: i
              };
          }
      }

      // 如果发生错误，返回第一个
      return {
          item: availableItems[0],
          index: 0
      };
  }

  // 随机选择两个不同的城邦羁绊
  function randomTwoAreas() {
      let areasCopy = [...ALL_AREAS];
      let selected = [];

      // 打乱数组
      for (let i = areasCopy.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [areasCopy[i], areasCopy[j]] = [areasCopy[j], areasCopy[i]];
      }

      // 选择前两个
      selected.push(areasCopy[0]);
      selected.push(areasCopy[1]);

      return selected;
  }

  // 随机选择海克斯挑战
  function randomHextech() {
      const hextechNames = Object.keys(HEXTEC_MAP);
      const randomIndex = Math.floor(Math.random() * hextechNames.length);
      const selectedName = hextechNames[randomIndex];

      return {
          name: selectedName,
          description: HEXTEC_MAP[selectedName]
      };
  }

  // 随机分配所有内容
  function randomizeAll() {
      // 验证玩家名单
      if (currentPlayers.length < 2) {
          showWarning('至少需要2名玩家才能开始分配');
          return;
      }

      // 检查是否有空姓名
      const emptyPlayers = currentPlayers.filter(name => name.trim() === '');
      if (emptyPlayers.length > 0) {
          showWarning('请填写所有玩家姓名');
          return;
      }

      const btn = document.getElementById('randomizeBtn');
      const loading = document.getElementById('loading');

      // 禁用按钮并显示加载动画
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 分配中...';
      loading.style.display = 'block';

      // 初始化显示区域
      initializePlayersDisplay();

      // 模拟加载时间
      setTimeout(() => {
          // 复制可用羁绊和权重
          let availableTraits = WEIGHTED_TRAITS.map(t => ({...t}));
          let availableWeights = availableTraits.map(t => t.weight);
          let availableTraitNames = availableTraits.map(t => t.name);

          // 存储分配结果
          currentAssignments = [];
          let pinduoduoCount = 0;

          // 为每个玩家分配
          currentPlayers.forEach((playerName, index) => {
              // 如果还有可用羁绊
              if (availableTraits.length > 0) {
                  // 权重随机选择羁绊
                  const selection = weightedRandomSelection(availableTraitNames, availableWeights);
                  const selectedTrait = selection.item;
                  const selectedIndex = selection.index;

                  // 记录分配结果
                  let assignment = {
                      player: playerName,
                      trait: selectedTrait,
                      extraAreas: [],
                      hextech: null
                  };

                  // 如果是拼多多，随机两个城邦羁绊
                  if (selectedTrait === "拼多多") {
                      pinduoduoCount++;
                      assignment.extraAreas = randomTwoAreas();
                  }

                  // 随机分配海克斯
                  assignment.hextech = randomHextech();

                  currentAssignments.push(assignment);

                  // 移除已分配的羁绊
                  availableTraits.splice(selectedIndex, 1);
                  availableWeights.splice(selectedIndex, 1);
                  availableTraitNames.splice(selectedIndex, 1);
              }
          });

          // 更新UI显示
          updateDisplay(currentAssignments);

          // 更新统计信息
          document.getElementById('pinduoduoCount').textContent = pinduoduoCount;
          document.getElementById('assignTime').textContent = new Date().toLocaleTimeString();

          // 恢复按钮状态
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-redo"></i> 重新分配';
          loading.style.display = 'none';

          // 添加动画效果
          addAnimation();

      }, 800); // 800ms加载时间
  }

  // 更新显示
  function updateDisplay(assignments) {
      assignments.forEach((assignment, index) => {
          // 更新羁绊显示
          const traitElement = document.getElementById(`trait${index}`);
          traitElement.textContent = assignment.trait;
          traitElement.classList.add('pulse');

          // 更新额外信息（如果是拼多多）
          const extraElement = document.getElementById(`extra${index}`);
          if (assignment.trait === "拼多多" && assignment.extraAreas.length === 2) {
              extraElement.innerHTML = `<i class="fas fa-map-marker-alt"></i> 包含：${assignment.extraAreas.join('、')}`;
              extraElement.style.display = 'block';
          } else {
              extraElement.style.display = 'none';
          }

          // 更新海克斯显示
          const hexNameElement = document.getElementById(`hexName${index}`);
          const hexDescElement = document.getElementById(`hexDesc${index}`);

          hexNameElement.innerHTML = `<i class="fas fa-magic"></i> ${assignment.hextech.name}`;
          hexDescElement.textContent = assignment.hextech.description;

          // 添加卡片动画
          const card = document.getElementById(`playerCard${index}`);
          card.classList.add('fade-in');
      });
  }

  // 重置全部
  function resetAll() {
      if (confirm('确定要重置所有内容吗？这将清空当前的分配结果。')) {
          currentPlayers = [...DEFAULT_PLAYERS];
          currentAssignments = [];

          // 重置UI
          initializePlayerInputs();
          initializePlayersDisplay();

          // 重置统计
          document.getElementById('pinduoduoCount').textContent = '0';
          document.getElementById('assignTime').textContent = '-';
          document.getElementById('totalPlayers').textContent = '4';

          // 重置按钮
          const randomizeBtn = document.getElementById('randomizeBtn');
          randomizeBtn.disabled = false;
          randomizeBtn.innerHTML = '<i class="fas fa-dice"></i> 开始随机分配';

          // 隐藏加载动画
          document.getElementById('loading').style.display = 'none';

          showWarning('已重置所有内容，可以重新开始设置');
      }
  }

  // 添加动画效果
  function addAnimation() {
      const cards = document.querySelectorAll('.player-card');
      cards.forEach(card => {
          card.style.animation = 'none';
          setTimeout(() => {
              card.style.animation = 'fadeIn 0.5s ease-out';
          }, 10);
      });
  }

  // 页面加载时初始化
  window.onload = function() {
      // 初始化玩家输入
      initializePlayerInputs();

      // 初始化结果显示
      initializePlayersDisplay();

      // 添加触摸反馈
      const randomizeBtn = document.getElementById('randomizeBtn');
      randomizeBtn.addEventListener('touchstart', function() {
          if (!this.disabled) {
              this.style.transform = 'scale(0.95)';
          }
      });

      randomizeBtn.addEventListener('touchend', function() {
          if (!this.disabled) {
              this.style.transform = 'scale(1)';
          }
      });

      // 更新统计
      updatePlayerCount();

      // 首次自动分配提示
      setTimeout(() => {
          if (confirm('欢迎使用金铲铲羁绊随机分配器！是否立即开始随机分配？')) {
              randomizeAll();
          }
      }, 1000);
  };
</script>
</body>
</html>
